<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
    integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
  <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
  <link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css' rel='stylesheet'>
  <link href='https://fonts.googleapis.com/css?family=Poppins' rel='stylesheet'>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"> </script>
  <link href='kamera.css' rel='stylesheet'>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Deteksi kanker kulit</title>
  <style>
    .body {
      background-color: rgb(250, 229, 250);
    }

    .center {
      display: flex;
      justify-content: center;
      align-items: center;
    }

    #video {
      width: 100%;
      aspect-ratio: 16/9;
      /* Adjust the aspect ratio as needed */
    }
    .warna1{
      background-color:#FB2576;
    }
    .warna2{
      background-color:#150050;
    }
    .warna3{
      background-color: #000000;
    }
    .warna4{
      background-color: #3F0071;
    }
  </style>
</head>

<body style="font-family:Poppins;">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="/">
      <img src="https://freepngimg.com/thumb/symbol/36430-5-cancer-logo-transparent.png" alt="Logo" width="50"
        height="50">
    </a>
    <a class="navbar-brand " style="color: #fb9ad1; ;">Deteksi Kanker Kulit</a>
    <div class="collapse navbar-collapse justify-content-end">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="btn btn-detect" style="color:#fb9ad1;" href="/">Home</a>
        </li>
      </ul>
    </div>
  </nav>

  <body>
    <div class="container-lg d-flex h-100 my-3 justify-content-center align-items-center ">
      <div class="container my-5 ml-auto w-100 bg-white" style="border-radius: 30px;">
        <div class="row">
          <div class="col-md-12 p-5 pt-1">
            <h2 class="text-center">Deteksi kanker kulit</h2>
            <hr>

            <!-- Camera Section -->
            <video id="video" width="640" height="480" autoplay="false" preload="none" class="center"></video>
            <canvas class="align-center center" id="canvas" width="640" height="480" style="display:none;"></canvas>
            <hr><br>
            <!-- Upload Section -->
            <div class="container d-flex justify-content-between">
              <div class="card border-secondary mb-3" style="max-width: 30rem;">
                <div class="card-header"><b>Deteksi melalui kamera</b></div>
                <div class="card-body text-secondary">
                  <h5 class="card-title text-secondary">Pilih Operasi Dibawah:</h5>
                  <button type="button" class="btn mr-3 my-3 warna1 text-light" id="start-camera">Start Camera</button>
                  <button type="button" class="btn mr-3 my-3 warna2 text-light" id="snap">Detect</button>
                  <button type="button" class="btn mr-3 my-3 warna3 text-light" id="stop-camera">Stop Camera</button>
                  <p id="camera-result"></p>
                </div>
              </div>
              <div class="card border-secondary mb-3" style="max-width: 30rem;">
                <div class="card-header"><b>Deteksi dengan upload gambar</b></div>
                <div class="card-body text-secondary">
                  <h5 class="card-title text-secondary">Silahkan Upload Gambar Anda:</h5>
                  <form id="upload-form" method="post" enctype="multipart/form-data">
                    <input type="file" name="file" id="file-input" class="my-3" required>
                    <input type="submit" class="btn warna4 text-light" value="Upload" class="my-3">
                  </form>
                  <p id="upload-result"></p>
                </div>
              </div>
            </div>
          </div>

          <script>
            // Access the camera and stream to the video element
            const video = document.getElementById('video');
            const canvas = document.getElementById('canvas');
            const snap = document.getElementById('snap');
            const startCamera = document.getElementById('start-camera');
            const stopCamera = document.getElementById('stop-camera');
            const cameraResult = document.getElementById('camera-result');
            let stream;

            function startVideoStream() {
              navigator.mediaDevices.getUserMedia({ video: true })
                .then(mediaStream => {
                  stream = mediaStream;
                  video.srcObject = stream;
                })
                .catch(err => {
                  console.error("Error accessing the camera: ", err);
                });
            }

            startCamera.addEventListener('click', () => {
              startVideoStream();
            });

            snap.addEventListener('click', () => {
              const context = canvas.getContext('2d');
              context.drawImage(video, 0, 0, 640, 480);
              const dataUrl = canvas.toDataURL('image/png');

              fetch('/predict', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json'
                },
                body: JSON.stringify({ image: dataUrl })
              })
                .then(response => response.json())
                .then(data => {
                  cameraResult.innerText = `Penyakit Kanker Yang di Prediksi: ${data.predicted_class}`;
                })
                .catch(err => {
                  console.error("Error in prediction: ", err);
                });
            });

            stopCamera.addEventListener('click', () => {
              if (stream) {
                const tracks = stream.getTracks();
                tracks.forEach(track => track.stop());
                video.srcObject = null;
              }
            });

            // Start the video stream when the page loads
            startVideoStream();

            // Upload Image
            const uploadForm = document.getElementById('upload-form');
            const uploadResult = document.getElementById('upload-result');

            uploadForm.addEventListener('submit', function (event) {
              event.preventDefault();
              const formData = new FormData(uploadForm);

              fetch('/upload', {
                method: 'POST',
                body: formData
              })
                .then(response => response.json())
                .then(data => {
                  uploadResult.innerText = `Penyakit Kanker yang di Prediksi: ${data.predicted_class}`;
                })
                .catch(err => {
                  console.error("Error in prediction: ", err);
                });
            });
          </script>
          <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
          <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
          <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>

</html>